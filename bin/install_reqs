#!/usr/bin/env bash
set -e
set -o pipefail
trap cleanup EXIT

export DEBIAN_FRONTEND='noninteractive'
export BASE_DEPS='apt-utils curl jq'

##
# Always cleanup after ourself.
cleanup() {
  echo "### $(basename $0) exiting..."
  unset DEBIAN_FRONTEND BASE_DEPS
}

##
# No real speed increase locally. We'll see what happens on dockerhub.
use_apt_mirror() {
  sed -i -E -e 's#http://(archive|security)#mirror://mirrors#' -e 's#ubuntu/#mirrors.txt#' /etc/apt/sources.list
}

main() {
  use_apt_mirror
  apt-get update
  apt-get install -y apt-utils curl jq
}

main "$@"
